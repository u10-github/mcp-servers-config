# Git操作と連動したCursorのAI活用ガイド

<!-- 
以下はCursorプロジェクトルール用の設定例です。実際に適用するには.mdcファイルとして保存し、
Cursor設定から追加する必要があります。
---
description: Git操作をフックとしてCursorのAIアシスタントを効果的に活用するためのルール（コミット、プッシュ、ブランチ操作の自動認識）
globs: **/*.git*, **/*.md, **/*.js, **/*.ts
---
-->

## 基本方針

- Git操作をトリガーとして、AIアシスタントが文脈を理解し適切な支援を提供
- コミット、プッシュ、ブランチ切替などの操作を自動検知して関連情報を提供
- プロジェクトの一貫性を保ちながら、効率的な開発をサポート

## Git操作の検知と対応

### 1. コミット操作の検知

コミット操作を検知したら、以下の情報を自動的に認識します：

- コミットメッセージの内容と意図
- 変更されたファイルの種類と範囲
- コミットの目的（機能追加、バグ修正、リファクタリングなど）

#### 対応アクション：

```
!コミット記録 [コミットハッシュ] [要約]
```

例：`!コミット記録 a1b2c3d "ログイン機能のバグ修正：セッションタイムアウト処理の改善"`

### 2. ブランチ操作の検知

ブランチの作成や切替を検知したら、以下の情報を自動的に認識します：

- ブランチの目的と作業内容
- 親ブランチとの関係
- 関連するチケットやタスク

#### 対応アクション：

```
!ブランチ記録 [ブランチ名] [目的]
```

例：`!ブランチ記録 feature/user-authentication "ユーザー認証機能の実装"`

### 3. プッシュ操作の検知

リモートリポジトリへのプッシュを検知したら、以下の情報を自動的に認識します：

- プッシュされた変更の範囲
- リモートブランチとの関係
- CIパイプラインの状態（可能な場合）

#### 対応アクション：

```
!プッシュ記録 [リモート名] [ブランチ名]
```

例：`!プッシュ記録 origin main`

### 4. プル/フェッチ操作の検知

リモートからの変更取得を検知したら、以下の情報を自動的に認識します：

- 取得された変更の概要
- 競合の有無とその内容
- 新たに追加されたコンポーネントや機能

#### 対応アクション：

```
!プル記録 [取得した変更の概要]
```

例：`!プル記録 "チームメンバーによるUI改善コミット3件を取得"`

## メモリとの連携

Git操作をフックとして、以下のようにメモリ機能と連携します：

1. **コミット時のメモリ更新**：
   - 重要なコミットの内容をメモリに記録
   - 例：`!記憶 コミット履歴 認証システムのリファクタリングを完了（コミットID: a1b2c3d）`

2. **ブランチ切替時のコンテキスト切替**：
   - ブランチごとの作業コンテキストを記憶
   - 例：`!コンテキスト切替 feature/payment-gateway`

3. **マージ時の変更履歴の統合**：
   - マージによる変更内容をまとめて記憶
   - 例：`!記憶統合 feature/user-settings main "ユーザー設定画面の実装完了"`

## Git操作に対するAIの振る舞い

### 1. コミット前の確認

コミットの準備段階で、AIは以下の確認を行います：

- テストが正常に通過しているか
- コーディング規約に準拠しているか
- セキュリティ上の問題がないか
- コミットメッセージは適切か

### 2. ブランチ作成時のサポート

新しいブランチを作成する際、AIは以下のサポートを提供します：

- ブランチ命名規則の提案
- 関連するタスクやチケットの情報表示
- 作業開始のためのチェックリスト提示

### 3. マージ時の競合解決

マージ時に競合が発生した場合、AIは以下のサポートを提供します：

- 競合部分の詳細説明
- 解決のための推奨アプローチ
- 類似の競合が過去にどう解決されたかの情報

### 4. プッシュ後のフィードバック

リモートへのプッシュ後、AIは以下のフィードバックを提供します：

- CIテスト結果の予測
- コードレビューのポイント
- 次に取り組むべきタスクの提案

## GitHubサーバーとの連携

GitHubのMCPサーバー（コマンド：`node C:/develop/mcp-servers/github-server/src/github/dist/index.js`）と連携することで、以下の機能が強化されます：

1. **リポジトリ情報の直接取得**：
   - リポジトリの状態をリアルタイムに把握
   - イシューやプルリクエストの情報を参照

2. **GitHub操作の自動化**：
   - コミット、プッシュ、PR作成などの操作を支援
   - コードレビューコメントの分析と対応提案

3. **チーム協業の強化**：
   - チームメンバーのアクティビティ把握
   - コードの変更履歴とその理由の理解

## コミットメッセージの規約

コミットメッセージは以下の形式に従うことを推奨します：

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの動作に影響しない変更（フォーマット等）
- `refactor`: バグ修正や機能追加ではないコード変更
- `perf`: パフォーマンス改善のための変更
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

例：`feat(auth): ソーシャルログイン機能の追加`

## ブランチ戦略

以下のブランチ戦略を推奨します：

1. **main/master**：リリース可能な状態を維持
2. **develop**：開発の最新状態
3. **feature/***：新機能の開発
4. **bugfix/***：バグ修正
5. **release/***：リリース準備
6. **hotfix/***：緊急のバグ修正

AIは各ブランチの目的を理解し、適切なコンテキストでサポートを提供します。

## Git操作の入出力の可視化

Git操作の認識と対応を明示的に表示するため、以下のガイドラインに従います：

1. **操作検知の通知**：
   - Git操作を検知した際に明示的に通知
   - 例：「🔍 **Git操作を検知しました**：feature/user-authブランチを作成」

2. **推奨アクションの提案**：
   - 検知した操作に基づいて推奨アクションを提案
   - 例：「💡 **推奨アクション**：テストを実行し、認証フローが正常に動作するか確認してください」

3. **関連情報の提示**：
   - 過去の関連するコミットや変更履歴を表示
   - 例：「📚 **関連する変更**：先週、認証システムのAPIエンドポイントが変更されています」

## 実行例

### コミット後の応答例

```
🔍 **コミットを検知しました**
コミットハッシュ: a1b2c3d
メッセージ: fix(auth): ログインフォームのバリデーション強化
変更ファイル: 3ファイル（src/auth/login.ts, src/utils/validation.ts, tests/auth/login.test.ts）

💡 **推奨アクション**:
- テストスイートを実行して変更の検証
- 関連するUIコンポーネントの動作確認

📝 **記憶しました** [認証システム]
ログインフォームのバリデーション強化：入力検証ロジックの改善とエラーメッセージの明確化
```

### ブランチ切替後の応答例

```
🔍 **ブランチ切替を検知しました**
移動先: feature/payment-integration
ベースブランチ: develop
作成者: TaroYamada
作成日: 2023-11-10

💡 **このブランチの目的**:
決済ゲートウェイ（Stripe）との統合機能の実装

📚 **関連タスク**:
- ISSUE-235: 決済プロセスの実装
- ISSUE-236: 決済成功/失敗画面の作成

🔄 **作業コンテキストを切り替えました**
このブランチでの前回の作業: データベースに決済情報を保存する機能の実装中
```

## 注意点

- Git操作の検知は自動的に行われますが、必要に応じて明示的に記録することも可能
- 秘匿情報（APIキー、パスワードなど）がコミットされないよう注意
- 大規模なマージやリベースの前には、念のためコードのバックアップを取ること
- Git操作の履歴を通じたプロジェクトの文脈理解は、プロジェクト固有の知識に基づいて行われる


<!--
## Cursorプロジェクトルールの設定方法

実際にこの内容をCursorのプロジェクトルールとして設定するには：

1. Cursor設定を開く（`Cmd/Ctrl + Shift + J`）
2. `General` > `Project Rules` に移動
3. `Add Rule` をクリックして新しいルールを作成
4. 以下の設定を行う：
   - Description: `Git操作をフックとしてCursorのAIアシスタントを効果的に活用するためのルール（コミット、プッシュ、ブランチ操作の自動認識）`
   - Globs: `**/*.git*, **/*.md, **/*.js, **/*.ts`
5. 本文に上記の内容（YAMLヘッダーを除く）を貼り付け
6. 必要に応じて `@file` ディレクティブを追加
-->

<!-- 
ファイル参照の例：
@file ./.git/config
@file ./README.md
--> 